# Gatsby Recipe Mediacurrent

# Gatsby Recipe Mediacurrent - Structure

Establish the basic project structure.

---

Make directories.

<Directory path="./src/utils" />
<Directory path="./src/hooks" />
<Directory path="./src/fragments" />
<Directory path="./src/templates" />
<Directory path="./src/styles" />
<Directory path="./src/styles/base" />
<Directory path="./src/styles/utils" />
<Directory path="./static" />

---

Add scripts.

<NPMScript name="start" command="gatsby develop -H 0.0.0.0" />
<NPMScript name="build:gatsby" command="gatsby build" />

---

Updates to gatsby-\* files.

<File
  path="./gatsby-node.js"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/structure/gatsby-node.js"
/>

---

Add base .gitignore file.

<File
  path="./.gitignore"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/structure/.gitignore"
/>

---

Add utils.

<File
  path="./src/utils/README.md"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/structure/utils/README.md"
/>
<File
  path="./src/utils/propTypeHelpers.js"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/structure/utils/propTypeHelpers.js"
/>

---

Add styles.

<File
  path="./src/styles/README.md"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/structure/styles/README.md"
/>
<File
  path="./src/styles/_global.scss"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/structure/styles/_global.scss"
/>
<File
  path="./src/styles/base/_base.scss"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/structure/styles/base/_base.scss"
/>
<File
  path="./src/styles/utils/_breakpoints.scss"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/structure/styles/utils/_breakpoints.scss"
/>
<File
  path="./src/styles/utils/_colors.scss"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/structure/styles/utils/_colors.scss"
/>
<File
  path="./src/styles/utils/_mixins.scss"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/structure/styles/utils/_mixins.scss"
/>
<File
  path="./src/styles/utils/_typography.scss"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/structure/styles/utils/_typography.scss"
/>
<File
  path="./src/styles/utils/_variables.scss"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/structure/styles/utils/_variables.scss"
/>
<File
  path="./src/styles/utils/_init.scss"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/structure/styles/utils/_init.scss"
/>
<File
  path="./src/styles/utils/color.stories.js"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/structure/styles/utils/color.stories.js"
/>

Project structure complete!

# Gatsby Recipe Mediacurrent - Prettier

Make sure all of your code is run through Prettier when you commit it to git. We achieve this by configuring prettier to run on git hooks using husky and lint-staged.

---

Install prettier packages.

<NPMPackage name="husky" />
<NPMPackage name="prettier" />
<NPMPackage name="lint-staged" />

---

Implement git hooks for prettier.

<NPMPackageJson
  name="husky"
  value={{
    hooks: {
      'pre-commit': 'lint-staged'
    }
  }}
/>
<NPMPackageJson
  name="lint-staged"
  value={{
    '*.{js,md,mdx,json}': ['prettier --write']
  }}
/>

---

Write prettier config files.

<File
  path=".prettierrc"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/prettier/.prettierrc"
/>
<File
  path=".prettierignore"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/prettier/.prettierignore"
/>

---

Write prettier script.

<NPMScript
  name="format"
  command='npx prettier --write \"**/*.{js,md,mdx,json}\"'
/>

Prettier, husky, and lint-staged are now installed! You can edit your `.prettierrc`
if you'd like to change your prettier configuration.

# Gatsby Recipe Mediacurrent - ESLint

Config ESLint plugins and settings to work with Mediacurrent standards.

---

Install ESLint packages

<NPMPackage name="eslint" />
<NPMPackage name="babel-eslint" />
<NPMPackage name="eslint-config-prettier" />
<NPMPackage name="eslint-plugin-jsx-a11y" />
<NPMPackage name="eslint-plugin-react" />
<NPMPackage name="eslint-plugin-react-hooks" />

---

Write ESLint config file.

<File
  path=".eslintrc.json"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/eslint/.eslintrc.json"
/>

ESLint is now installed and configured!

# Gatsby Recipe Mediacurrent - Babel

Config Babel plugins and settings to work with Mediacurrent standards.

---

Install Babel packages

<NPMPackage name="@babel/core" />
<NPMPackage name="@babel/plugin-proposal-optional-chaining" />
<NPMPackage name="babel-loader" />
<NPMPackage name="babel-plugin-macros" />
<NPMPackage name="babel-preset-gatsby" />

---

Add Babel config to package.json.

<File
  path=".babelrc"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/babel/.babelrc"
/>

Babel is now installed and configured!

# Gatsby Recipe Mediacurrent - Plop

Add plop file and configuration for easy and consistent component creation.

---

Install plop packages.

<NPMPackage name="plop" />

---

Create plop config and templates.

<File
  path="plopfile.js"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/plop/plopfile.js"
/>
<Directory path="plop-templates" />
<File
  path="plop-templates/component.js.hbs"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/plop/plop-templates/component.js.hbs"
/>
<File
  path="plop-templates/data.js.hbs"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/plop/plop-templates/data.js.hbs"
/>
<File
  path="plop-templates/story.js.hbs"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/plop/plop-templates/story.js.hbs"
/>
<File
  path="plop-templates/styles.module.scss.hbs"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/plop/plop-templates/styles.module.scss.hbs"
/>

---

Add npm script for plopping a component.

<NPMPackageJson name="plop" value={{`plop component`}} />

Plop is now installed! You can create a new component by running `npm run component`.

---

# Add Storybook to Gatsby project

[Storybook](https://storybook.js.org/) is an open source tool for developing UI components in isolation for React, Vue, and Angular. It makes building stunning UIs organized and efficient.

---

Install babel plugins and presets as well as the Storybook React NPM packages and addons

<NPMPackage name="babel-loader" />
<NPMPackage name="@babel/preset-react" />
<NPMPackage name="@babel/preset-env" />
<NPMPackage name="@babel/plugin-proposal-class-properties" />
<NPMPackage name="babel-plugin-remove-graphql-queries" />
<NPMPackage name="babel-plugin-react-docgen" />
<NPMPackage name="focus-visible" />
<NPMPackage name="@storybook/react" />
<NPMPackage name="@storybook/addon-actions" />
<NPMPackage name="@storybook/addon-docs" />
<NPMPackage name="@storybook/addon-knobs" />
<NPMPackage name="@storybook/addon-storyshots" />
<NPMPackage name="@storybook/addon-a11y" />

---

Create JavaScript Storybook webpack config (main.js)

<File
  path="./.storybook/main.js"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/storybook/main.js"
/>

---

Configure Storybook / Gatsby Link settings (preview.js)

<File
  path="./.storybook/preview.js"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/storybook/preview.js"
/>

---

Add location decorator.

<File
  path="./.storybook/locationDecorator.js"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/storybook/locationDecorator.js"
/>

---

Update gitignore file.

<File
  path="./.gitignore"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/storybook/.gitignore"
/>

---

Add Storybook npm scripts

<NPMScript
  name="build:storybook"
  command="NODE_ENV=production build-storybook --quiet -s ./static -c .storybook -o public/storybook"
/>
<NPMScript
  name="build"
  command="npm run build:gatsby && npm run build:storybook"
/>
<NPMScript
  name="storybook"
  command="NODE_ENV=production start-storybook -s ./static -p 6006"
/>

---

## You're all done!

Before your run Storybook make sure you run `gatsby develop` or `gatsby build`. This ensures that Gatsby's GraphQL data is available in Storybook.

# Gatsby Recipe Mediacurrent - Sass Lint

Adds sass-lint configuration for consistent CSS rules.

---

Install sass-lint package.

<NPMPackage name="sass-lint" />

---

Create sass-lint config file.

<File
  path="./.sass-lint.yml"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/sass-lint/.sass-lint.yml"
/>

---

Add config file to package.json.

<NPMPackageJson name="sasslintConfig" value={{".sass-lint.yml"}} />

Sass-lint is now installed and configured!

# Gatsby Recipe Mediacurrent - ENV

Setup .env files and how they work with Gatsby.

---

Update .gitignore file.

<File
  path="./.gitignore"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/env/.gitignore"
/>

---

Create .env files

<File path="./.env" content="# Env file" />

<File path="./.env.production" content="# Env values for prod" />

<File path="./.env.development" content="# Env values for dev" />

---

Install Gatsby plugin for access ENV vars inside components.

<NPMPackage name="gatsby-plugin-env-variables" />

<GatsbyPlugin
  name="gatsby-plugin-env-variables"
  options={{
    allowList: []
  }}
/>

---

Import ENV to gatsby-node and gatsby-config files.

<File
  path="./gatsby-node.js"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/env/gatsby-node.js"
/>
<File
  path="./gatsby-config.js"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/env/gastby-config.js"
/>

Okay, env files have been setup!

# Gatsby Recipe Mediacurrent - SVGs

Makes the unique changes necessary for using SVGs in the project.

---

Install Gatsby SVG plugin.

<NPMPackage name="gatsby-plugin-react-svg" />

---

Configure Gatsby SVG plugin.

<GatsbyPlugin
  name="gatsby-plugin-react-svg"
  options={{
    rule: {
      include: /assets\/.+\.svg$/
    }
  }}
/>
---

Update the Storybook config to process SVGs.

<File
  path="./.storybook/main.js"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/svg/storybook-main.js"
/>

Great! You can now import SVGs as React components, or use them inline in your CSS.

# Gatsby Recipe Mediacurrent - Jest

Configure jest folders, files, and settings.

---

Install jest packages and dependencies.

<NPMPackage name="jest" />
<NPMPackage name="babel-jest" />
<NPMPackage name="jest-runner-eslint" />
<NPMPackage name="jest-runner-sasslint" />
<NPMPackage name="@testing-library/react" />
<NPMPackage name="@testing-library/jest-dom" />
<NPMPackage name="react-test-renderer" />

---

Create mock directory and files.

<Directory path="./__mocks__" />
<File
  path="./__mocks__/gatsby.js"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/jest/__mocks__/gatsby.js"
/>
<File
  path="./__mocks__/file-mock.js"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/jest/__mocks__/file-mock.js"
/>

---

Create config files and directories.

<Directory path="./test" />

<File
  path="./test/jest-common.js"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/jest/test/jest-common.js"
/>
<File
  path="./test/jest-loadershim.js"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/jest/test/jest-loadershim.js"
/>
<File
  path="./test/jest-preprocess.js"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/jest/test/jest-preprocess.js"
/>
<File
  path="./test/jest.client.js"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/jest/test/jest.client.js"
/>
<File
  path="./test/jest.lint.js"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/jest/test/jest.lint.js"
/>
<File
  path="./test/jest.scss.js"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/jest/test/jest.scss.js"
/>
<File
  path="./test/jest.setup.js"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/jest/test/jest.setup.js"
/>
<File
  path="./test/jest.storybook.js"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/jest/test/jest.storybook.js"
/>
<File
  path="./jest.config.js"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/jest/jest.config.js"
/>

---

Add file for mocking hooks in Jest Storyshots.

<File
  path="./storyshots.test.js"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/jest/storyshots.test.js"
/>

---

Add npm scripts for Jest.

<NPMScript name="test" command="jest --silent" />
<NPMScript name="test:coverage" command="jest --coverage" />
<NPMScript name="test:update" command="npm run test:coverage -- -u" />
<NPMScript name="lint" command="npm run lint:sass && npm run lint:js" />
<NPMScript name="lint:js" command="jest --config ./test/jest.lint.js" />
<NPMScript name="lint:sass" command="jest --config ./test/jest.scss.js" />

---

Add Jest to lint-staged.

<NPMPackageJson
  name="lint-staged"
  value={{
     "src/**/*.js": [
      "jest --findRelatedTests"
    ],
    "*.scss": [
      "npm run lint:sass"
    ]
  }}
/>

Alright! Jest is now installed and configured for your project!
