# Gatsby Recipe Mediacurrent

# Gatsby Recipe Mediacurrent - Structure

Establish the basic project structure.

---

Make directories.

<Directory path="src/utils" />

<File
  path="src/utils/README.md"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/structure/utils/README.md"
/>

Project structure complete!

# Gatsby Recipe Mediacurrent - Prettier

Make sure all of your code is run through Prettier when you commit it to git. We achieve this by configuring prettier to run on git hooks using husky and lint-staged.

---

Install prettier packages.

<NPMPackage name="husky" />
<NPMPackage name="prettier" />
<NPMPackage name="lint-staged" />

---

Implement git hooks for prettier.

<NPMPackageJson
  name="husky"
  value={`{
    hooks: {
      'pre-commit': 'lint-staged'
    }
  }`}
/>
<NPMPackageJson
  name="lint-staged"
  value={`{
    '*.{js,md,mdx,json}': ['prettier --write']
  }`}
/>

---

Write prettier config files.

<File
  path=".prettierrc"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/prettier/.prettierrc"
/>
<File
  path=".prettierignore"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/prettier/.prettierignore"
/>

---

Write prettier script.

<NPMScript
  name="format"
  command='npx prettier --write \"**/*.{js,md,mdx,json}\"'
/>

Prettier, husky, and lint-staged are now installed! You can edit your `.prettierrc`
if you'd like to change your prettier configuration.

# Gatsby Recipe Mediacurrent - ESLint

Config ESLint plugins and settings to work with Mediacurrent standards.

---

Install ESLint packages

<NPMPackage name="eslint" />
<NPMPackage name="babel-eslint" />
<NPMPackage name="eslint-config-prettier" />
<NPMPackage name="eslint-plugin-jsx-a11y" />
<NPMPackage name="eslint-plugin-react" />
<NPMPackage name="eslint-plugin-react-hooks" />

---

Write ESLint config file.

<File
  path=".eslintrc.json"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/eslint/.eslintrc.json"
/>

ESLint is now installed and configured!

# Gatsby Recipe Mediacurrent - Babel

Config Babel plugins and settings to work with Mediacurrent standards.

---

Install Babel packages

<NPMPackage name="@babel/core" />
<NPMPackage name="@babel/plugin-proposal-optional-chaining" />
<NPMPackage name="babel-loader" />
<NPMPackage name="babel-plugin-macros" />
<NPMPackage name="babel-preset-gatsby" />

---

Add Babel config to package.json.

<File
  path=".babelrc"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/babel/.babelrc"
/>

Babel is now installed and configured!

# Gatsby Recipe Mediacurrent - Plop

Add plop file and configuration for easy and consistent component creation.

---

Install plop packages.

<NPMPackage name="plop" />

---

Create plop config and templates.

<File
  path="plopfile.js"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/plop/plopfile.js"
/>
<Directory path="plop-templates" />
<File
  path="plop-templates/component.js.hbs"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/plop/plop-templates/component.js.hbs"
/>
<File
  path="plop-templates/data.js.hbs"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/plop/plop-templates/data.js.hbs"
/>
<File
  path="plop-templates/story.js.hbs"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/plop/plop-templates/story.js.hbs"
/>
<File
  path="plop-templates/styles.module.scss.hbs"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/plop/plop-templates/styles.module.scss.hbs"
/>

---

Add npm script for plopping a component.

<NPMPackageJson name="plop" value={`plop component`} />

Plop is now installed! You can create a new component by running `npm run component`.

---

# Add Storybook to Gatsby project

[Storybook](https://storybook.js.org/) is an open source tool for developing UI components in isolation for React, Vue, and Angular. It makes building stunning UIs organized and efficient.

---

Install babel plugins and presets as well as the Storybook React NPM packages and addons

<NPMPackage name="babel-loader" />
<NPMPackage name="@babel/preset-react" />
<NPMPackage name="@babel/preset-env" />
<NPMPackage name="@babel/plugin-proposal-class-properties" />
<NPMPackage name="babel-plugin-remove-graphql-queries" />
<NPMPackage name="babel-plugin-react-docgen" />
<NPMPackage name="focus-visible" />

<NPMPackage name="@storybook/react" />
<NPMPackage name="@storybook/addon-actions" />
<NPMPackage name="@storybook/addon-docs" />
<NPMPackage name="@storybook/addon-knobs" />
<NPMPackage name="@storybook/addon-storyshots" />
<NPMPackage name="@storybook/addon-a11y" />

---

Create JavaScript Storybook webpack config (main.js)

<File
  path="./.storybook/main.js"
  content="https://raw.githubusercontent.com/mediacurrent/gatsby-recipe-mediacurrent/master/recipe/storybook/main.js"
/>

---

Configure Storybook / Gatsby Link settings (preview.js)

<File
  path="./.storybook/preview.js"
  content="https://raw.githubusercontent.com/PaulieScanlon/gatsby-recipe-storybook-js/master/recipe/preview.js"
/>

---

Add location decorator.

<File
  path="./.storybook/locationDecorator.js"
  content="https://raw.githubusercontent.com/PaulieScanlon/gatsby-recipe-storybook-js/master/recipe/locationDecorator.js"
/>

---

Add Storybook npm scripts

<NPMScript
  name="build:storybook"
  command="NODE_ENV=production build-storybook --quiet -s ./static -c .storybook -o static/storybook"
/>
<NPMScript
  name="build"
  command="npm run build:gatsby && npm run build:storybook && copyfiles -u 1 static/storybook/* public"
/>
<NPMScript
  name="storybook"
  command="NODE_ENV=production start-storybook -s ./static -p 6006"
/>

---

## You're all done!

Before your run Storybook make sure you run `gatsby develop` or `gatsby build`. This ensures that Gatsby's GraphQL data is available in Storybook.
